webpackJsonp([1],{"18op":function(t,e){},"66Zj":function(t,e){},L9qB:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("7+uW"),n=s("/ocq"),a=s("mtWM"),o=s.n(a),l="https://bus-yoyaku.higashino-lab.org/api/v4/",r=function(t,e,s){const i={username:t,password:e};console.log(i),o.a.post(l+"token/",i).then(t=>{console.log(t),localStorage.setItem("token",t.data.token),s(!0)}).catch(t=>{console.log(t),s(!1)})},c=function(t){const e={headers:{Authorization:"JWT "+localStorage.getItem("token")}};console.log(e),o.a.all([o.a.get(l+"user/",e),o.a.get(l+"message/",e),o.a.get(l+"alert/",e),o.a.get(l+"reservation/",e)]).then(o.a.spread((e,s,i,n)=>{t(!0,e.data,s.data,i.data,n.data)})).catch(e=>{console.log(e),console.log(e.response.status),t(!1,{},{},{},{},{})})},h=function(t,e,s){console.log(t);const i=localStorage.getItem("token");o.a.get(l+"reservable-stop/"+t+"/"+e,{headers:{Authorization:"JWT "+i}}).then(t=>{s(!0,t.data)}).catch(t=>{console.log(t.response.status),s(!1,{})})},d=function(t){const e=localStorage.getItem("token");o.a.get(l+"user/",{headers:{Authorization:"JWT "+e}}).then(e=>{console.log(e.data.area),t(!0,e.data.area)}).catch(e=>{console.log(e),t(!1,-1)})},u=function(t,e,s,i,n){const a=localStorage.getItem("token"),r={stop_location:t,stop_time:e,date:s,num_of_people:i};console.log(r),o.a.post(l+"reservation/",r,{headers:{Authorization:"JWT "+a}}).then(t=>{n(!0),console.log(response)}).catch(t=>{n(!1)})},g=function(t,e){const s=localStorage.getItem("token");o.a.patch(l+"reservation/"+t,{state:"canceled"},{headers:{Authorization:"JWT "+s}}).then(t=>{e(!0)}).catch(t=>{e(!1)})},v=function(){localStorage.clear()},p=function(){return!!localStorage.getItem("token")},_={data:function(){return{user:{},loading:!0,sending_going_res:!1,sending_returning_res:!1,message:null,alertMessage:null,goingRes:null,returningRes:null,updateCount:0}},methods:{reserveGoing:function(){this.sending_going_res=!0,this.$router.replace("/reservation-going")},reserveReturning:function(){this.sending_returning_res=!0,this.$router.replace("/reservation-returning")},cancelGoingRes:function(){this.sending_going_res=!0,g(this.goingRes.id,t=>{t&&(this.goingRes=null),this.sending_going_res=!1})},cancelReturningRes:function(){this.sending_going_res=!0,g(this.returningRes.id,t=>{t&&(this.returningRes=null),this.sending_returning_res=!1})},loadData:function(){c(this.mainScreenDataCallback)},update:function(){if(console.log(this.updateCount),this.updateCount<=0){this.loadData();const t=(new Date).getHours();this.updateCount=0<=t&&t<=5?20:1}else this.updateCount-=1},mainScreenDataCallback:function(t,e,s,i,n){t&&(console.log(n),this.user=e,console.log(this.user),this.message=s,console.log(this.message),this.alertMessage=i,console.log(this.alertMessage),this.goingRes=n.going,console.log(this.goingRes),this.returningRes=n.returning,console.log(this.returningRes)),this.loading=!1}},created(){this.loading=!0,this.loadData(),setInterval(this.update,15e3)}},m={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"main"}},[this.loading?e("div",{staticClass:"loading-message"},[this._m(0)]):this._e(),this._v(" "),this.loading?this._e():e("div",{staticClass:"row"},[e("div",{staticClass:"col s12 top-message"},[e("span",[this._v("こんにちは "+this._s(this.user.last_name)+" さん")])]),this._v(" "),this.goingRes||this.returningRes?this._e():e("div",{staticClass:"col s12 message"},[e("span",[this._v(this._s(this.message.text))])]),this._v(" "),e("div",{staticClass:"col s12 m12 l10 offset-l1 center"},[e("div",{staticClass:"row"},[this.goingRes?this._e():e("div",[e("div",{staticClass:"col s12 m6 center"},[e("button",{staticClass:"waves-effect waves-light btn-large reservation-button",on:{click:this.reserveGoing}},[e("span",{staticClass:"bold"},[this._v("行きのバス")]),e("span",[this._v("を予約する")])])])]),this._v(" "),this.goingRes?e("div",[e("div",{staticClass:"col s12 m5 card-panel teal lighten-5 reservation-card"},[e("div",{staticClass:"left-align"},[e("span",{staticClass:"red-text bold small-text"},[this._v("行きのバスを予約済み")]),this._v(" "),e("ul",[e("li",[e("span",{staticClass:"small-text"},[this._v("場所: ")]),this._v(" "),e("span",{staticClass:"bold small-text"},[this._v(this._s(this.goingRes.stop_location.name))])]),this._v(" "),e("li",[e("span",{staticClass:"small-text"},[this._v("時刻: ")]),this._v(" "),e("span",{staticClass:"bold small-text"},[this._v(this._s(this.goingRes.display_date)+" "+this._s(this.goingRes.stop_time.display_time))])]),this._v(" "),e("li",[e("span",{staticClass:"small-text"},[this._v("人数: ")]),this._v(" "),e("span",{staticClass:"bold small-text"},[this._v(this._s(this.goingRes.num_of_people)+"人")])])])]),this._v(" "),e("button",{staticClass:"btn red cancel-button center",attrs:{disabled:this.sending_going_res},on:{click:this.cancelGoingRes}},[e("span",{staticClass:"bold small-text"},[this._v("この予約を取り消す")])])])]):this._e(),this._v(" "),this.returningRes?this._e():e("div",[e("div",{staticClass:"col s12 m6"},[e("button",{staticClass:"waves-effect waves-light btn-large reservation-button",on:{click:this.reserveReturning}},[e("span",{staticClass:"bold"},[this._v("帰りのバス")]),e("span",[this._v("を予約する")])])])]),this._v(" "),this.returningRes?e("div",[e("div",{staticClass:"col s12 m5 center card-panel teal lighten-5 reservation-card"},[e("div",{staticClass:"left-align"},[e("span",{staticClass:"red-text bold small-text"},[this._v("帰りのバスを予約済み")]),this._v(" "),e("ul",[e("li",[e("span",{staticClass:"small-text"},[this._v("場所: ")]),this._v(" "),e("span",{staticClass:"bold small-text"},[this._v(this._s(this.returningRes.stop_location.name))])]),this._v(" "),e("li",[e("span",{staticClass:"small-text"},[this._v("時刻: ")]),this._v(" "),e("span",{staticClass:"bold small-text"},[this._v(this._s(this.returningRes.display_date)+" "+this._s(this.returningRes.stop_time.display_time))])]),this._v(" "),e("li",[e("span",{staticClass:"small-text"},[this._v("人数: ")]),this._v(" "),e("span",{staticClass:"bold small-text"},[this._v(this._s(this.returningRes.num_of_people)+"人")])])])]),this._v(" "),e("button",{staticClass:"btn red center",attrs:{disabled:this.sending_returning_res},on:{click:this.cancelReturningRes}},[e("span",{staticClass:"bold small-text"},[this._v("この予約を取り消す")])])])]):this._e()])]),this._v(" "),!this.goingRes|!this.returningRes?e("div",{staticClass:"col s12 alert card-panel red lighten-5"},[e("span",{staticClass:"bold red-text"},[this._v(this._s(this.alertMessage.text))])]):this._e()])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col s12 top-message"},[e("span",[this._v("読み込み中です。しばらくお待ちください。")])])}]},f=s("VU/8")(_,m,!1,function(t){s("18op")},"data-v-e6d2fba0",null).exports,C={props:["reservations"],data:function(){return{canceling:!1}},methods:{cancelButtonClicked:function(t){this.canceling=!0,g(t.id,t=>{console.log("Cancel Reservation Success"),this.$emit("update"),this.canceling=!1})}},computed:{topMessage:function(){return this.reservations&&0==this.reservations.length?"予約はありません。":this.reservations&&this.reservations.length>0?this.reservations.length+"件の予約があります。":void 0}},created:function(){console.log("created"),console.log(this.reservations)},mounted:function(){console.log("mounted"),console.log(this.reservations)}},b={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[s("p",{staticClass:"top-message"},[t._v(t._s(t.topMessage))]),t._v(" "),t._l(t.reservations,function(e){return s("div",{key:e.name},[s("div",{staticClass:"row center card-panel teal lighten-5 bold reservation-card"},[t._v("\n            "+t._s(e.display_date)+" "+t._s(e.stop_time.display_time)+" "),s("br"),t._v("\n            "+t._s(e.stop_location.name)+" 発 "),s("br"),t._v(" "),s("button",{staticClass:"waves-effect waves-light btn red",attrs:{disabled:t.canceling},on:{click:function(s){t.cancelButtonClicked(e)}}},[e.canceling?t._e():s("span",[t._v("この予約を取り消す")])])])])})],2)},staticRenderFns:[]},S={components:{ReservationList:s("VU/8")(C,b,!1,function(t){s("ktLE")},"data-v-8c9160a2",null).exports},data:function(){return{user:{},message:null,alertMessage:null,reservations:[],loadSuccessed:!1}},methods:{mainScreenDataCallback:function(t,e,s,i,n){t&&(console.log(n),this.reservations=n,console.log(e),this.user=e,console.log(s),this.message=s,console.log(i),this.alertMessage=i,this.loadSuccessed=!0)},loadData:function(){c(this.mainScreenDataCallback)},reserveButtonClicked:function(){this.$router.replace("/reservation-going")}},created:function(){this.loadData(),setInterval(this.update,2e4)}},w={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"top-screen"}},[this.loadSuccessed?this._e():e("div",{staticClass:"row center message"},[e("p",[this._v("読み込み中です")])]),this._v(" "),this.loadSuccessed?e("div",{staticClass:"row message"},[e("span",[this._v("こんにちは "+this._s(this.user.last_name)+" さん ")]),this._v(" "),e("br"),this._v(" "),e("span",{staticClass:"info"},[this._v(this._s(this.message.text))])]):this._e(),this._v(" "),this.loadSuccessed?e("reservation-list",{staticClass:"reservations",attrs:{reservations:this.reservations},on:{update:this.loadData}}):this._e(),this._v(" "),this.loadSuccessed&&this.reservations.length<2?e("div",{staticClass:"reservation center"},[e("button",{staticClass:"waves-effect waves-light btn-large",on:{click:this.reserveButtonClicked}},[this.reservations.length<1?e("span",[this._v("バスを予約する")]):this._e(),this._v(" "),this.reservations.length>=1?e("span",[this._v("さらにバスを予約する")]):this._e()])]):this._e(),this._v(" "),this.loadSuccessed&&this.alertMessage?e("div",{staticClass:"alert red lighten-5"},[e("p",{staticClass:"red-text"},[this._v(this._s(this.alertMessage.text))])]):this._e()],1)},staticRenderFns:[]},R=s("VU/8")(S,w,!1,function(t){s("nvBZ")},"data-v-302fc8d7",null).exports,k={data:function(){return{form:{username:"",password:""},sending:!1,error:!1}},methods:{loginCallback:function(t){this.sending=!1,t?(this.error=!1,this.$router.replace("/")):this.error=!0},loginButtonClicked:function(){this.sending=!0,r(this.form.username,this.form.password,this.loginCallback)}}},x={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row",staticStyle:{padding:"8px"}},[s("div",{staticClass:"col s12"},[s("h5",{staticClass:"center-align"},[t._v("ユーザ名とパスワードを入力してログインしてください")]),t._v(" "),t.error?s("h5",{staticClass:"center-align red-text"},[t._v("IDかパスワードが誤っています")]):t._e()]),t._v(" "),s("div",{staticClass:"col s12 m8 offset-m2"},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-content"},[s("div",{staticClass:"row"},[s("div",{staticClass:"input-field col s12"},[s("form",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.username,expression:"form.username"}],attrs:{autocomplete:"username",placeholder:"ユーザ名",id:"id-number",type:"text"},domProps:{value:t.form.username},on:{input:function(e){e.target.composing||t.$set(t.form,"username",e.target.value)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.password,expression:"form.password"}],attrs:{autocomplete:"current-password",placeholder:"パスワード",id:"password",type:"password"},domProps:{value:t.form.password},on:{input:function(e){e.target.composing||t.$set(t.form,"password",e.target.value)}}})])])])])])]),t._v(" "),s("div",{staticClass:"col s12 center"},[s("button",{staticClass:"waves-effect waves-light btn-large",attrs:{id:"login-button",disabled:t.sending},on:{click:t.loginButtonClicked}},[t._v("ログイン")])])])},staticRenderFns:[]},y=s("VU/8")(k,x,!1,function(t){s("66Zj")},"data-v-2af520f2",null).exports,D={data:function(){return{selectedStopLocation:null,selectedStopDate:null,selectedNumOfPeople:1,selectingSequenceNumber:0,errorMessage:null}},methods:{load_data:function(){console.log("load data"),d((t,e)=>{t?(this.bus_type="going",e||(e=1),h(e,this.bus_type,(t,s)=>{t?(console.log(e,this.bus_type,s),0==s.length?this.errorMessage="このユーザーには地区が設定されていないか，地区に停留所が存在しません":(this.selectedStopLocation=s[0],this.selectingSequenceNumber=1)):(console.log("failed for loading available stops"),this.errorMessage="利用可能な停留所が見つかりませんでした")})):this.errorMessage="このユーザーには地区が設定されていません"})},selectDate:function(t){this.selectedStopDate=t,this.selectingSequenceNumber=2},selectTime:function(t){this.selectedStopTime=t,this.selectedNumOfPeople=1,this.selectingSequenceNumber=3,this.reserve()},reserve:function(){u(this.selectedStopLocation.id,this.selectedStopTime.id,this.selectedStopDate.stop_date,this.selectedNumOfPeople,t=>{setTimeout(()=>{this.$router.replace("/")},2e3)})},reset:function(){this.$router.replace("/")}},computed:{topMessage:function(){return this.errorMessage?this.errorMessage:0==this.selectingSequenceNumber?"読み込み中です。しばらくお待ちください。":1==this.selectingSequenceNumber&&this.selectedStopLocation.available_days.length>0?"何日の "+this.selectedStopLocation.name+" 発のバスを予約しますか":1==this.selectingSequenceNumber&&this.selectedStopLocation.available_days.length<=0?"現在予約可能なバスはありません。時刻表・運休等をご確認ください。":2==this.selectingSequenceNumber&&this.selectedStopDate.stoptimes.length>0?this.selectedStopDate.display_stop_date+" "+this.selectedStopLocation.name+" の 何時発のバスを予約しますか？":2==this.selectingSequenceNumber&&this.selectedStopDate.stoptimes.length<=0?this.selectedStopDate.display_stop_date+"で予約可能なバスはありません。時刻表・運休等をご確認ください。":this.selectingSequenceNumber>=3?this.selectedStopLocation.name+" "+this.selectedStopDate.display_stop_date+" "+this.selectedStopTime.display_time+"で予約中です。しばらくお待ちください。":void 0}},mounted(){this.load_data()}},N={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"reservation-screen"}},[s("div",{staticClass:"row top-message"},[s("p",[t._v(t._s(t.topMessage))])]),t._v(" "),1==t.selectingSequenceNumber?s("div",{staticClass:"button-list"},t._l(t.selectedStopLocation.available_days,function(e){return s("div",{key:e.display_date,staticClass:"row center"},[s("button",{staticClass:"col m5 s12 waves-effect waves-light btn-large center",on:{click:function(s){t.selectDate(e)}}},[s("span",[t._v(t._s(e.display_stop_date))])])])})):t._e(),t._v(" "),2==t.selectingSequenceNumber?s("div",{staticClass:"button-list"},t._l(t.selectedStopDate.stoptimes,function(e){return s("div",{key:e.display_time,staticClass:"row center"},[s("button",{staticClass:"col m12 s12 waves-effect waves-light btn-large center",on:{click:function(s){t.selectTime(e)}}},[s("span",[t._v(t._s(e.display_time)+" 発")])])])})):t._e(),t._v(" "),s("div",{staticClass:"cancel-button-wrapper"},[s("div",{staticClass:"row center"},[s("button",{staticClass:"btn-large red",attrs:{disabled:t.selectingSequenceNumber>=3},on:{click:t.reset}},[s("span",[t._v("最初からやりなおす")])])])])])},staticRenderFns:[]},M=s("VU/8")(D,N,!1,function(t){s("L9qB")},"data-v-4d891981",null).exports,q={name:"app",data:function(){return{nowReservationScreen:!1}},watch:{$route(t,e){console.log("route changed"),console.log(t),console.log(e),"top"==t.name?this.nowReservationScreen=!1:"top"==e.name&&(this.nowReservationScreen=!0)}}},$={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:{"green-background":this.nowReservationScreen},attrs:{id:"app"}},[this._m(0),this._v(" "),e("main",{attrs:{id:"main"}},[e("router-view")],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("header",[e("nav",{staticClass:"deep-orange lighten-2"},[e("div",{staticClass:"nav-wrapper"},[e("a",{staticClass:"flow-text",staticStyle:{"margin-left":"16px"},attrs:{href:"#/"}},[this._v("デマンドバス予約")])])])])}]},E=s("VU/8")(q,$,!1,function(t){s("qhvN")},"data-v-5a0d33f5",null).exports;i.a.use(n.a),i.a.config.productionTip=!1;var L=new n.a({routes:[{path:"/",name:"top",component:R,beforeEnter:function(t,e,s){p()?s():s("/login")}},{path:"/login",name:"login",component:y,beforeEnter:function(t,e,s){p()?s("/"):s()}},{path:"/logout",name:"logout",beforeEnter:function(t,e,s){v(),s("/login")}},{path:"/reservation-going",name:"reservation-going",component:M,props:{bus_type:"going"},beforeEnter:function(t,e,s){p()?s():s("/login")}},{path:"/reservation-returning",name:"reservation-returning",component:M,props:{bus_type:"returning"},beforeEnter:function(t,e,s){p()?s():s("/login")}}]});new i.a({el:"#app",router:L,template:"<App/>",components:{App:E,TopScreen:R,MainScreen:f,LoginScreen:y}})},ktLE:function(t,e){},nvBZ:function(t,e){},qhvN:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.c8b63fbd1a6f634b731e.js.map